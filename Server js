const express = require('express');
const { ethers } = require('ethers');
require('dotenv').config();

const app = express();
const port = 3000;

// Middleware to serve static files (like CSS, JS)
app.use(express.static('public'));

// Hardhat provider (assuming Hardhat is running locally)
const provider = new ethers.JsonRpcProvider('http://localhost:8545'); 

// Define your contract ABIs
const contractABI = [
  // Add your contract ABI here, for example:
  {
    "constant": true,
    "inputs": [],
    "name": "getData",
    "outputs": [
      {
        "name": "",
        "type": "uint256"
      }
    ],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  }
];

// Route to fetch contract data based on address
app.get('/contract-data/:address', async (req, res) => {
  const contractAddress = req.params.address; // Get the contract address from the URL

  const contract = new ethers.Contract(contractAddress, contractABI, provider);

  try {
    const data = await contract.getData(); // Call a contract function (example: getData)
    res.json({ data });
  } catch (error) {
    console.error('Error fetching data from contract:', error);
    res.status(500).json({ error: 'Error fetching data' });
  }
});

app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`);
});
